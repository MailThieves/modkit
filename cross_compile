#!/bin/bash

# Instructions for setting up cross compiling here:
# https://medium.com/swlh/compiling-rust-for-raspberry-pi-arm-922b55dbb050

set -o errexit
set -o nounset
set -o pipefail
set -o xtrace

readonly TARGET_ARCH=armv7-unknown-linux-gnueabihf
readonly MODKIT_PATH=./target/${TARGET_ARCH}/release/examples/modkit
readonly GPIO_EXAMPLE_PATH=./target/${TARGET_ARCH}/release/examples/gpio
readonly CONTACT_SENSOR_TEST_PATH=./target/${TARGET_ARCH}/release/examples/contact_sensor_test
readonly CAMERA_TEST_PATH=./target/${TARGET_ARCH}/release/examples/camera_test
readonly LIGHT_TEST_PATH=./target/${TARGET_ARCH}/release/examples/light_test
readonly RPPAL_LIGHT_TEST_PATH=./target/${TARGET_ARCH}/release/examples/rppal_light_test

cargo build --example modkit --release --target=${TARGET_ARCH}
cargo build --example gpio --release --target=${TARGET_ARCH}
cargo build --example contact_sensor_test --release --target=${TARGET_ARCH}
cargo build --example camera_test --release --target=${TARGET_ARCH}
cargo build --example light_test --release --target=${TARGET_ARCH}
cargo build --example rppal_light_test --release --target=${TARGET_ARCH}

cp $MODKIT_PATH bin/rpi/modkit
cp $GPIO_EXAMPLE_PATH bin/rpi/gpio_status
cp $CONTACT_SENSOR_TEST_PATH bin/rpi/watch_contact_sensor
cp $CAMERA_TEST_PATH bin/rpi/camera_test
cp $LIGHT_TEST_PATH bin/rpi/light_test
cp $RPPAL_LIGHT_TEST_PATH bin/rpi/rppal_light_test

git add .
git commit -m "Updates executables"

